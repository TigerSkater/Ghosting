<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Squash Ghosting Drill</title>
  <style>
    body {
      font-family: Arial;
      text-align: center;
      padding: 20px;
      background: #C4F0A8; /* light green background */
    }
    #direction {
      font-size: 3em;
      margin: .5em 0;
      color: #2c3e50;
    }
    #countdown {
      font-size: 4em;
      color: #8e44ad;
      margin: 1em 0;
    }
    #image {
      width: 250px;
      height: 250px;
      margin: 0 auto 1em;
    }
    input, button {
      font-size: 1.2em;
      padding: 5px;
      margin: 5px;
    }
    label {
      font-size: 1.2em;
      margin: 0 10px 0 0;
    }
  </style>
</head>
<body>
  <h1>Squash Ghosting Drill</h1>
  
  <!-- TEST IMAGE TO CHECK IF IMAGES LOAD -->
  <img src="images/front-left.png" alt="Test Image" width="150" />
  <!-- END TEST IMAGE -->
  
  <div>
    <label>Sets:</label><input type="number" id="setsInput" min="1" value="3"/>
    <label>Moves per set:</label><input type="number" id="movesInput" min="1" value="15"/>
    <br><br>
    <label>Seconds per move:</label><input type="number" id="secondsInput" min="1" value="3"/>
    <label>Break between moves (s):</label><input type="number" id="moveBreakInput" min="0" value="1"/>
    <label>Break between sets (s):</label><input type="number" id="setBreakInput" min="1" value="6"/>
    <div>
      <input type="checkbox" id="motivationCheckbox" checked/>
      <label for="motivationCheckbox">Enable Motivational Messages</label>
    </div>
    <br><br>
    <button onclick="startDrill()">Start Drill</button>
    <button onclick="stopDrill()">Stop Drill</button>
  </div>
  <div id="direction"></div>
  <div id="countdown"></div>
  <img id="image" src="" alt="Direction Arrow"/>

<script>
const directions = [
  { name: "Front Left",  img: "images/front-left.png" },
  { name: "Front Right", img: "images/front-right.png" },
  { name: "Side Left",   img: "images/side-left.png" },
  { name: "Side Right",  img: "images/side-right.png" },
  { name: "Back Left",   img: "images/back-left.png" },
  { name: "Back Right",  img: "images/back-right.png" }
];

const motivationalLines = [
  "Your break is over. Cry later. Move now.",
  "The floor misses you. Go make it sweat!",
  "Congratulations, you are nowâ€¦ still not done!",
  "Your coach called. They said move it!"
];

let currentSet = 0, moveCount = 0, totalSets = 0, movesPerSet = 0,
    secondsPerMove = 0, breakPerMove = 0, breakPerSet = 0,
    interval, countdownInterval, stopped = false, motivationOn = true;

const directionEl = document.getElementById("direction"),
      countdownEl = document.getElementById("countdown"),
      imageEl = document.getElementById("image"),
      motivationCheckbox = document.getElementById("motivationCheckbox");

function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.rate = 1.1;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function playBeep() {
  new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();
}

function playBonk() {
  new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg").play();
}

function startDrill() {
  stopped = false; currentSet = 1; moveCount = 0;
  totalSets = parseInt(document.getElementById("setsInput").value);
  movesPerSet = parseInt(document.getElementById("movesInput").value);
  secondsPerMove = parseInt(document.getElementById("secondsInput").value);
  breakPerMove = parseInt(document.getElementById("moveBreakInput").value);
  breakPerSet = parseInt(document.getElementById("setBreakInput").value);
  motivationOn = motivationCheckbox.checked;
  runMove();
}

function stopDrill() {
  stopped = true;
  clearTimeout(interval);
  clearInterval(countdownInterval);
  directionEl.textContent = "Drill Stopped.";
  imageEl.src = "";
  countdownEl.textContent = "";
  speechSynthesis.cancel();
}

function runMove() {
  if (stopped) return;
  if (moveCount >= movesPerSet) {
    if (currentSet >= totalSets) {
      directionEl.textContent = "Drill Complete!";
      imageEl.src = "";
      countdownEl.textContent = "";
      return;
    }
    runSetBreak(); return;
  }

  const move = directions[Math.floor(Math.random() * directions.length)];
  directionEl.textContent = move.name;
  imageEl.src = move.img;
  countdownEl.textContent = "";
  playBeep(); speak(move.name);
  moveCount++;

  interval = setTimeout(() => {
    if (stopped) return;
    directionEl.textContent = "";
    imageEl.src = "";
    playBonk(); // bonk after image disappears
    setTimeout(() => {
      if (!stopped) runMove();
    }, breakPerMove * 1000);
  }, secondsPerMove * 1000);
}

function runSetBreak() {
  currentSet++;
  moveCount = 0;
  directionEl.textContent = "Break between sets";
  imageEl.src = "";
  let countdown = breakPerSet;
  countdownEl.textContent = countdown;

  // Beep immediately for the first number
  playBeep();

  countdownInterval = setInterval(() => {
    if (stopped) {
      clearInterval(countdownInterval);
      return;
    }
    countdown--;
    if (countdown > 0) {
      countdownEl.textContent = countdown;
      playBeep();
    } else {
      clearInterval(countdownInterval);
      countdownEl.textContent = "";
      if (motivationOn) {
        const msg = motivationalLines[Math.floor(Math.random() * motivationalLines.length)];
        speak(msg);
        setTimeout(() => { if (!stopped) runMove(); }, 3000);
      } else {
        playBeep();
        runMove();
      }
    }
  }, 1000);
}
</script>
</body>
</html>
